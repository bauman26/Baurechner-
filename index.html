<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hausmeisterservice Hashimi â€“ Baukalkulator (Pro)</title>
<style>
  :root{
    --bg:#0f1418; --card:#131a20; --ink:#eaf2f0; --muted:#a9b7b3;
    --accent:#1f7a55; --accent-2:#2ea26f; --line:#23303a; --warn:#e6b800;
    --radius:14px; --pad:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 system-ui,Arial}
  header{background:linear-gradient(180deg,var(--card),#0d1216);border-bottom:1px solid var(--line);padding:18px 0}
  .brand{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:14px;padding:0 18px}
  .brand img{width:44px;height:44px;border-radius:10px;object-fit:contain;background:#0e151a;border:1px solid var(--line);padding:6px}
  .brand .t{display:flex;flex-direction:column}
  .brand h1{margin:0;font-size:20px;letter-spacing:.3px}
  .brand .sub{font-size:12px;color:var(--muted)}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  .grid{display:grid;grid-template-columns:1fr;gap:18px}
  @media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:var(--pad);box-shadow:0 10px 30px rgba(0,0,0,.25)}
  h2{margin:.2rem 0 1rem 0;font-size:20px;color:#bfe8d4}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  label{font-size:13px;color:var(--muted)}
  input,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0d1216;color:var(--ink)}
  input:focus,select:focus{outline:none;border-color:#3ab381;box-shadow:0 0 0 3px rgba(58,179,129,.2)}
  .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer}
  button.secondary{background:#1c2630}
  button.warn{background:var(--warn);color:#222}
  details{border:1px dashed var(--line);border-radius:12px;padding:10px;margin-top:10px}
  details summary{cursor:pointer;color:#cfe8da}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-top:1px solid var(--line);padding:10px;text-align:left;vertical-align:top}
  th{color:#cfe8da;font-weight:600;background:#0e151a}
  tfoot td{font-weight:700}
  .sum{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  .ok{color:#8de6b4}
  .muted{color:var(--muted)}
  .foot{margin-top:24px;font-size:12px;color:var(--muted);text-align:center}
  @media print{
    header,.btns,.foot,details{display:none}
    body{background:white;color:#222}
    .card{box-shadow:none;border:1px solid #ddd}
    table,th,td{border-color:#ddd}
  }
</style>
</head>
<body>
<header>
  <div class="brand">
    <img src="logo.png" alt="Hausmeisterservice Hashimi" onerror="this.style.display='none'">
    <div class="t">
      <h1>Hausmeisterservice Hashimi â€“ Baukalkulator</h1>
      <div class="sub">Trockenbau â€¢ Putz/Spachtel â€¢ Materialmengen â€¢ Lohn â€¢ Fixkosten â€¢ MwSt</div>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="grid">

    <!-- TROCKENBAU -->
    <section class="card" id="tb">
      <h2>ðŸ§± Trockenbau â€“ Kalkulation (mit Mengen)</h2>

      <div class="row">
        <div>
          <label>FlÃ¤che (mÂ²)</label>
          <input type="number" id="tb_f" placeholder="z. B. 50" min="0" step="0.01">
        </div>
        <div>
          <label>MwSt (%)</label>
          <input type="number" id="tb_vat" value="19" min="0" step="0.1">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Stundenlohn (â‚¬)</label>
          <input type="number" id="tb_wage" value="28" min="0" step="0.01">
        </div>
        <div>
          <label>Arbeitszeit h/mÂ² (Montage + Grundspachtel, 1-lagig)</label>
          <input type="number" id="tb_h_m2" value="0.40" min="0" step="0.01">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Fixkosten pauschal (â‚¬)</label>
          <input type="number" id="tb_fix" value="100" min="0" step="0.01">
        </div>
        <div>
          <label>Schichtzahl</label>
          <select id="tb_layers">
            <option value="1">1-lagig</option>
            <option value="2">2-lagig</option>
          </select>
        </div>
      </div>

      <details>
        <summary>Material-Faktoren je mÂ² & Einzelpreise (bearbeitbar)</summary>
        <div class="row">
          <div>
            <label>Platten Faktor mÂ²/mÂ²</label>
            <input type="number" id="tb_fac_platte" value="1.00" step="0.01">
          </div>
          <div>
            <label>Platten â‚¬/mÂ²</label>
            <input type="number" id="tb_eur_platte" value="4.50" step="0.01">
          </div>
        </div>
        <div class="row">
          <div>
            <label>Profile Faktor m/mÂ²</label>
            <input type="number" id="tb_fac_profile" value="0.80" step="0.01">
          </div>
          <div>
            <label>Profile â‚¬/m</label>
            <input type="number" id="tb_eur_profile" value="1.80" step="0.01">
          </div>
        </div>
        <div class="row">
          <div>
            <label>Schrauben Faktor Stk/mÂ²/Lage</label>
            <input type="number" id="tb_fac_screw" value="15" step="1">
          </div>
          <div>
            <label>Schrauben â‚¬/Stk</label>
            <input type="number" id="tb_eur_screw" value="0.02" step="0.001">
          </div>
        </div>
        <div class="row">
          <div>
            <label>Spachtel (Q2) Faktor kg/mÂ²</label>
            <input type="number" id="tb_fac_spachtel" value="0.60" step="0.01">
          </div>
          <div>
            <label>Spachtel â‚¬/kg</label>
            <input type="number" id="tb_eur_spachtel" value="0.85" step="0.01">
          </div>
        </div>
        <div class="row">
          <div>
            <label>Fugendeckstreifen Faktor m/mÂ²</label>
            <input type="number" id="tb_fac_band" value="0.50" step="0.01">
          </div>
          <div>
            <label>Fugendeckstreifen â‚¬/m</label>
            <input type="number" id="tb_eur_band" value="0.25" step="0.01">
          </div>
        </div>
        <div class="row">
          <div>
            <label>AbhÃ¤nger (Decke) Faktor Stk/mÂ²</label>
            <input type="number" id="tb_fac_abhaenger" value="1.20" step="0.01">
          </div>
          <div>
            <label>AbhÃ¤nger â‚¬/Stk</label>
            <input type="number" id="tb_eur_abhaenger" value="0.60" step="0.01">
          </div>
        </div>
        <div class="muted" style="margin-top:6px">
          Richtwerte â€“ bitte je System anpassen.
        </div>
      </details>

      <div class="btns">
        <button onclick="calcTB()">Berechnen</button>
        <button class="secondary" onclick="saveInputs()">Eingaben merken</button>
        <button class="secondary" onclick="restoreInputs()">Eingaben laden</button>
        <button class="warn" onclick="window.print()">Als PDF drucken/teilen</button>
      </div>

      <div id="tb_out"></div>
    </section>

    <!-- PUTZ / SPACHTEL -->
    <section class="card" id="pz">
      <h2>ðŸŽ¨ Putz & Spachtel â€“ Kalkulation (mit kg)</h2>

      <div class="row">
        <div>
          <label>FlÃ¤che (mÂ²)</label>
          <input type="number" id="pz_f" placeholder="z. B. 50" min="0" step="0.01">
        </div>
        <div>
          <label>MwSt (%)</label>
          <input type="number" id="pz_vat" value="19" min="0" step="0.1">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Leistung</label>
          <select id="pz_art">
            <option value="Q2">Spachtel Q2</option>
            <option value="Q3">Spachtel Q3</option>
            <option value="Q4">Spachtel Q4 (vollflÃ¤chig)</option>
            <option value="GRUNDPUTZ">Grundputz</option>
            <option value="FEINPUTZ">Feinputz</option>
          </select>
        </div>
        <div>
          <label>Materialpreis â‚¬/kg</label>
          <input type="number" id="pz_eurkg" value="0.85" min="0" step="0.01">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Arbeitszeit h/mÂ²</label>
          <input type="number" id="pz_h_m2" value="0.25" min="0" step="0.01">
        </div>
        <div>
          <label>Stundenlohn (â‚¬)</label>
          <input type="number" id="pz_wage" value="28" min="0" step="0.01">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Fixkosten pauschal (â‚¬)</label>
          <input type="number" id="pz_fix" value="60" min="0" step="0.01">
        </div>
        <div>
          <label>Aufschlag/DB (%)</label>
          <input type="number" id="pz_markup" value="8" min="0" step="0.1">
        </div>
      </div>

      <details>
        <summary>Optional: Grundierung mitrechnen</summary>
        <div class="row">
          <div>
            <label>Grundierung Faktor l/mÂ²</label>
            <input type="number" id="pz_fac_grund" value="0.15" step="0.01">
          </div>
          <div>
            <label>Grundierung â‚¬/l</label>
            <input type="number" id="pz_eur_grund" value="3.20" step="0.01">
          </div>
        </div>
      </details>

      <div class="btns">
        <button onclick="calcPZ()">Berechnen</button>
        <button class="secondary" onclick="saveInputs()">Eingaben merken</button>
        <button class="secondary" onclick="restoreInputs()">Eingaben laden</button>
        <button class="warn" onclick="window.print()">Als PDF drucken/teilen</button>
      </div>

      <div id="pz_out"></div>
    </section>
  </div>

  <!-- GESAMT -->
  <section class="card">
    <h2>ðŸ“Š Zusammenfassung</h2>
    <div id="sum_out" class="sum">
      <div class="muted">Noch keine Berechnung â€“ bitte oben berechnen.</div>
    </div>
    <div class="muted" style="margin-top:8px">Inhaber: <b>Murtaza Hashimi</b> â€¢ Hausmeisterservice Hashimi</div>
  </section>

  <div class="foot">Â© Hausmeisterservice Hashimi â€“ Richtwerte ohne GewÃ¤hr. Faktoren/Preise bitte je Projekt prÃ¼fen.</div>
</div>

<script>
/* ---------- Presets Putz/Spachtel ---------- */
const PZ_PRESETS = {
  Q2:  { kg_m2: 0.6,  h_m2: 0.25 },
  Q3:  { kg_m2: 1.0,  h_m2: 0.35 },
  Q4:  { kg_m2: 1.8,  h_m2: 0.55 },
  GRUNDPUTZ: { kg_m2: 8.0, h_m2: 0.40 },
  FEINPUTZ:  { kg_m2: 2.5, h_m2: 0.30 }
};

/* ---------- Helpers ---------- */
const n = v => (isFinite(v)? Number(v):0);
const fmt = v => (v||0).toLocaleString('de-DE',{style:'currency',currency:'EUR'});
function line(label,qty,unit,price){ return {label,qty,unit,price,sum:qty*price}; }
function table(title, rows, vat){
  const net = rows.reduce((a,r)=>a + r.sum, 0);
  const mwst = net * (vat/100);
  const brutto = net + mwst;
  let html = `<h3 style="margin:12px 0;">${title}</h3>
  <table>
    <thead><tr><th>Position</th><th>Menge</th><th>Einheit</th><th>Einzelpreis</th><th>Summe</th></tr></thead>
    <tbody>`;
  rows.forEach(r=>{
    html += `<tr><td>${r.label}</td><td class="muted">${r.qty.toLocaleString('de-DE',{maximumFractionDigits:2})}</td><td class="muted">${r.unit}</td><td>${fmt(r.price)}</td><td>${fmt(r.sum)}</td></tr>`;
  });
  html += `</tbody>
    <tfoot>
      <tr><td colspan="4">Zwischensumme (netto)</td><td>${fmt(net)}</td></tr>
      <tr><td colspan="4">MwSt (${vat}%)</td><td>${fmt(mwst)}</td></tr>
      <tr><td colspan="4">Gesamtsumme (brutto)</td><td>${fmt(brutto)}</td></tr>
    </tfoot>
  </table>`;
  return {html,net,brutto};
}

/* ---------- Trockenbau mit Mengen ---------- */
function calcTB(){
  const A     = n(document.getElementById('tb_f').value);
  const VAT   = n(document.getElementById('tb_vat').value);
  const wage  = n(document.getElementById('tb_wage').value);
  const h_m2  = n(document.getElementById('tb_h_m2').value);
  const fix   = n(document.getElementById('tb_fix').value);
  const L     = n(document.getElementById('tb_layers').value);

  // Faktoren + Preise (Richtwerte)
  const fac_platte   = n(document.getElementById('tb_fac_platte').value);
  const eur_platte   = n(document.getElementById('tb_eur_platte').value);
  const fac_profile  = n(document.getElementById('tb_fac_profile').value);
  const eur_profile  = n(document.getElementById('tb_eur_profile').value);
  const fac_screw    = n(document.getElementById('tb_fac_screw').value);
  const eur_screw    = n(document.getElementById('tb_eur_screw').value);
  const fac_spachtel = n(document.getElementById('tb_fac_spachtel').value);
  const eur_spachtel = n(document.getElementById('tb_eur_spachtel').value);
  const fac_band     = n(document.getElementById('tb_fac_band').value);
  const eur_band     = n(document.getElementById('tb_eur_band').value);
  const fac_abhaenger= n(document.getElementById('tb_fac_abhaenger').value);
  const eur_abhaenger= n(document.getElementById('tb_eur_abhaenger').value);

  // Mengen
  const q_platte    = A * fac_platte * L;   // mÂ²
  const q_profile   = A * fac_profile;      // m
  const q_screw     = A * fac_screw * L;    // Stk
  const q_spachtel  = A * fac_spachtel;     // kg
  const q_band      = A * fac_band;         // m
  const q_abhaenger = A * fac_abhaenger;    // Stk

  // Lohn
  const h_total     = A * h_m2 * L;
  const lohn_total  = h_total * wage;

  // Zeilen
  const rows = [
    line('Gipskartonplatten', q_platte, 'mÂ²', eur_platte),
    line('Profile (UW/CW oder UD/CD)', q_profile, 'm', eur_profile),
    line('Schrauben', q_screw, 'Stk', eur_screw),
    line('Spachtel (Q2)', q_spachtel, 'kg', eur_spachtel),
    line('Fugendeckstreifen', q_band, 'm', eur_band),
    line('AbhÃ¤nger/Verbinder', q_abhaenger, 'Stk', eur_abhaenger),
    line('Lohn (h Ã— FlÃ¤che Ã— Lagen)', h_total, 'h', wage),
    line('Fixkosten pauschal', 1, 'Stk', fix)
  ];

  const res = table('Trockenbau â€“ Aufstellung mit Mengen', rows, VAT);
  document.getElementById('tb_out').innerHTML = res.html;
  updateSum();
}

/* ---------- Putz/Spachtel ---------- */
const PZ_PRESETS = PZ_PRESETS || {}; // (sicher)
function applyPreset(){
  const art = document.getElementById('pz_art').value;
  const p   = PZ_PRESETS[art];
  if(!p) return;
  document.getElementById('pz_h_m2').value = p.h_m2;
}
document.getElementById('pz_art').addEventListener('change', applyPreset);
applyPreset();

function calcPZ(){
  const A   = n(document.getElementById('pz_f').value);
  const VAT = n(document.getElementById('pz_vat').value);
  const art = document.getElementById('pz_art').value;
  const eurkg = n(document.getElementById('pz_eurkg').value);
  const h_m2  = n(document.getElementById('pz_h_m2').value);
  const wage  = n(document.getElementById('pz_wage').value);
  const fix   = n(document.getElementById('pz_fix').value);
  const mk    = n(document.getElementById('pz_markup').value);

  const kg_m2 = PZ_PRESETS[art]?.kg_m2 ?? 1;
  const kg_total = A * kg_m2;                // kg Material
  const mat_total = kg_total * eurkg;

  // optionale Grundierung
  const fac_gr = n(document.getElementById('pz_fac_grund').value || 0);
  const eur_gr = n(document.getElementById('pz_eur_grund').value || 0);
  const l_gr   = A * fac_gr;
  const gr_total = l_gr * eur_gr;

  const lohn_total= (A * h_m2) * wage;
  const aufschlag = (mat_total + gr_total + lohn_total + fix) * (mk/100);

  const rows = [
    line(`Material ${art}`, kg_total, 'kg', eurkg),
    ...(fac_gr>0 ? [line('Grundierung', l_gr, 'l', eur_gr)] : []),
    line('Lohn (h Ã— FlÃ¤che)', A*h_m2, 'h', wage),
    line('Fixkosten pauschal', 1, 'Stk', fix),
    line('Aufschlag/Deckungsbeitrag', 1, 'Stk', aufschlag)
  ];

  const res = table('Putz & Spachtel â€“ Aufstellung (mit kg)', rows, VAT);
  document.getElementById('pz_out').innerHTML = res.html;
  updateSum();
}

/* ---------- Zusammenfassung ---------- */
function parseTotals(boxId){
  const box = document.getElementById(boxId);
  if(!box) return {net:0, brutto:0};
  const t = box.querySelectorAll('tfoot td:last-child');
  if(!t.length) return {net:0, brutto:0};
  const netto  = toNumber(t[0].textContent);
  const brutto = toNumber(t[2].textContent);
  return {net:netto, brutto};
}
function toNumber(txt){
  return n(String(txt).replace(/[^\d,.-]/g,'').replace(/\./g,'').replace(',', '.'));
}
function updateSum(){
  const tb = parseTotals('tb_out');
  const pz = parseTotals('pz_out');
  const net = tb.net + pz.net;
  const brutto = tb.brutto + pz.brutto;
  const m2 = n(document.getElementById('tb_f').value) + n(document.getElementById('pz_f').value);
  const per = m2>0 ? brutto/m2 : 0;

  const html = `
    <div class="card">
      <h3 style="margin:0 0 8px 0;">Netto gesamt</h3>
      <div style="font-size:24px" class="ok">${fmt(net)}</div>
    </div>
    <div class="card">
      <h3 style="margin:0 0 8px 0;">Brutto gesamt</h3>
      <div style="font-size:24px" class="ok">${fmt(brutto)}</div>
      <div class="muted">Richtwert brutto pro mÂ²: <b>${fmt(per)}</b></div>
    </div>`;
  document.getElementById('sum_out').innerHTML = html;
}

/* ---------- Speicher ---------- */
function saveInputs(){
  const ids = Array.from(document.querySelectorAll('input,select')).map(el=>el.id).filter(Boolean);
  const data = {}; ids.forEach(id=>data[id]=document.getElementById(id).value);
  localStorage.setItem('hashimi_calc_v2', JSON.stringify(data));
  alert('Eingaben gespeichert.');
}
function restoreInputs(){
  const raw = localStorage.getItem('hashimi_calc_v2');
  if(!raw){ alert('Keine gespeicherten Eingaben gefunden.'); return; }
  const data = JSON.parse(raw);
  Object.entries(data).forEach(([k,v])=>{ const el=document.getElementById(k); if(el) el.value=v; });
  applyPreset();
  alert('Eingaben geladen.');
}
  /* --------- Speicher --------- */
function saveInputs(){
  const ids = Array.from(document.querySelectorAll('input, select')).map(el=>el.id).filter(Boolean);
  const data = {}; ids.forEach(id => data[id] = document.getElementById(id)?.value || "");
  localStorage.setItem('hashimi_calc_v2', JSON.stringify(data));
  alert('Eingaben gespeichert.');
}

function restoreInputs(){
  const raw = localStorage.getItem('hashimi_calc_v2');
  if(!raw){ alert('Keine gespeicherten Eingaben gefunden.'); return; }
  const data = JSON.parse(raw);
  Object.entries(data).forEach(([k,v]) => { const el=document.getElementById(k); if(el) el.value=v; });
  alert('Eingaben geladen.');
}

/* ðŸ‘‰ HIER KOMMT DER NEUE TEIL ðŸ‘‡ */
document.addEventListener('DOMContentLoaded', () => {
  const num = v => parseFloat(String(v).replace(',', '.')) || 0;
  const fmt = v => new Intl.NumberFormat('de-DE', {minimumFractionDigits:2, maximumFractionDigits:2}).format(v);
  
  document.querySelectorAll('button').forEach(btn => {
    if (/berechnen/i.test(btn.textContent)) {
      btn.addEventListener('click', e => {
        e.preventDefault();
        const card = btn.closest('.card');
        const inputs = card.querySelectorAll('input, select');
        if(inputs.length === 0) return;

        const fl = num(inputs[0].value);
        const mw = num(inputs[1].value);
        const lohn = num(inputs[2].value);
        const zeit = num(inputs[3].value);
        const fix = num(inputs[4].value);
        const schichten = /2/.test(inputs[5].value) ? 2 : 1;

        const lohnstunden = fl * zeit * schichten;
        const lohnkosten = lohnstunden * lohn;
        const matkosten = fl * 4.5 * schichten; // einfacher Materialfaktor
        const netto = lohnkosten + matkosten + fix;
        const mwst = netto * mw / 100;
        const brutto = netto + mwst;

        let box = card.querySelector('.result');
        if(!box){
          box = document.createElement('div');
          box.className = 'result';
          box.style.marginTop = '12px';
          box.style.color = '#9ad39b';
          card.appendChild(box);
        }
        box.innerHTML = `
          FlÃ¤che: <b>${fmt(fl)}</b> mÂ², Schichten: <b>${schichten}</b><br>
          Lohnkosten: <b>${fmt(lohnkosten)}</b> â‚¬, Material: <b>${fmt(matkosten)}</b> â‚¬, Fix: <b>${fmt(fix)}</b> â‚¬<br>
          Netto: <b>${fmt(netto)}</b> â‚¬, MwSt: <b>${fmt(mwst)}</b> â‚¬, 
          <span style="color:#ffd166;">Brutto: <b>${fmt(brutto)}</b> â‚¬</span>
        `;
      });
    }
  });
});
/* ðŸ‘† Ende des neuen Codes */
</script>
</body>
</html>
</script>
</body>
</html>
